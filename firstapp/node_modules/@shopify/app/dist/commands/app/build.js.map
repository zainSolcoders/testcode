{"version":3,"file":"build.js","sources":["../../../src/cli/services/web.ts","../../../src/cli/services/build.ts","../../../src/cli/commands/app/build.ts"],"sourcesContent":["import {Web} from '../models/app/app'\nimport {error, system} from '@shopify/cli-kit'\nimport {WebConfigurationCommands} from 'cli/models/app/app'\nimport {Writable} from 'node:stream'\n\ninterface WebOptions {\n  web: Web\n  stdout: Writable\n  stderr: Writable\n  signal: error.AbortSignal\n}\n\nexport default async function web(\n  command: WebConfigurationCommands,\n  {web, stdout, stderr, signal}: WebOptions,\n): Promise<void> {\n  const script = web.configuration.commands[command]\n  if (!script) {\n    return\n  }\n\n  const [cmd, ...args] = script.split(' ')\n  await system.exec(cmd, args, {cwd: web.directory, stdout, stderr, signal})\n  stdout.write('Web successfully built.')\n}\n","import {buildExtension} from './build/extension'\nimport buildWeb from './web'\nimport {installAppDependencies} from './dependencies'\nimport {App, Web} from '../models/app/app'\nimport {error, output} from '@shopify/cli-kit'\nimport {Writable} from 'node:stream'\n\ninterface BuildOptions {\n  app: App\n  skipDependenciesInstallation: boolean\n}\n\nasync function build({app, skipDependenciesInstallation}: BuildOptions) {\n  if (!skipDependenciesInstallation) {\n    await installAppDependencies(app)\n  }\n  await output.concurrent([\n    ...app.webs.map((web: Web) => {\n      return {\n        prefix: web.configuration.type,\n        action: async (stdout: Writable, stderr: Writable, signal: error.AbortSignal) => {\n          await buildWeb('build', {web, stdout, stderr, signal})\n        },\n      }\n    }),\n    {\n      prefix: 'extensions',\n      action: async (stdout: Writable, stderr: Writable, signal: error.AbortSignal) => {\n        await buildExtension({app, extensions: app.extensions.ui, stdout, stderr, signal})\n      },\n    },\n  ])\n\n  output.newline()\n  output.success(`${app.name} built`)\n}\n\nexport default build\n","import {appFlags} from '../../flags'\nimport {App, load as loadApp} from '../../models/app/app'\nimport build from '../../services/build'\nimport {Command, Flags} from '@oclif/core'\nimport {path, cli} from '@shopify/cli-kit'\n\nexport default class Build extends Command {\n  static description = 'Build the app'\n\n  static flags = {\n    ...cli.globalFlags,\n    ...appFlags,\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'skip-dependencies-installation': Flags.boolean({\n      hidden: false,\n      description: 'Skips the installation of dependencies.',\n      env: 'SHOPIFY_FLAG_SKIP_DEPENDENCIES_INSTALLATION',\n      default: false,\n    }),\n  }\n\n  async run(): Promise<void> {\n    const {flags} = await this.parse(Build)\n    const directory = flags.path ? path.resolve(flags.path) : process.cwd()\n    const app: App = await loadApp(directory)\n    await build({app, skipDependenciesInstallation: flags['skip-dependencies-installation']})\n  }\n}\n"],"names":["web","buildWeb","loadApp"],"mappings":"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"}